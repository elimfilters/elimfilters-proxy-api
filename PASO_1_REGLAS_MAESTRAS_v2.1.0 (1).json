{
  "version": "2.2.0",
  "timestamp": "2025-10-17T22:00:00Z",
  "description": "Reglas maestras ELIMFILTERS - ACTUALIZADAS con reglas correctas de SKU",
  
  "oem_universe": {
    "patterns": {
      "donaldson": {
        "primary": [
          "/^P\\d{5,6}$/i",
          "/^DBL/i",
          "/^P[0-9]{4,7}$/i"
        ],
        "fallback": ["/^P[0-9]+$/i"],
        "brand": "DONALDSON",
        "priority": 1,
        "duty": "HD",
        "description": "PRIORIDAD 1 para HD - Buscar primero",
        "examples": ["P552100", "P164378", "DBL123"]
      },
      
      "fram": {
        "primary": [
          "/^(PH|CA|CF|CH)\\d{3,6}$/i",
          "/^PH[0-9]{1,5}$/i",
          "/^CA[0-9]{3,6}$/i",
          "/^CF[0-9]{3,6}$/i",
          "/^CH[0-9]{3,6}$/i"
        ],
        "fallback": [],
        "brand": "FRAM",
        "priority": 1,
        "duty": "LD",
        "description": "PRIORIDAD 1 para LD - Buscar primero",
        "examples": ["PH8A", "CA123", "CF456", "CH789"]
      },
      
      "generic": {
        "patterns": ["/^[A-Z0-9]{3,10}$/i"],
        "priority": 2,
        "duty": "any",
        "description": "OEM más comercial - Fallback si no se encuentra marca prioritaria",
        "examples": ["LF3620", "1R1808", "FF5052"]
      }
    },
    
    "brands": {
      "HD_PRIORITY": [
        "CATERPILLAR", "CAT", "CUMMINS", "DETROIT", "VOLVO",
        "MACK", "PACCAR", "NAVISTAR", "INTERNATIONAL", "FREIGHTLINER",
        "KOMATSU", "JOHN DEERE", "CASE", "NEW HOLLAND", "DONALDSON",
        "BALDWIN", "FLEETGUARD", "DURAMAX"
      ],
      "LD_PRIORITY": [
        "TOYOTA", "NISSAN", "HONDA", "BMW", "AUDI", "LEXUS",
        "VOLKSWAGEN", "CHEVROLET", "FORD", "KIA", "HYUNDAI", "FRAM",
        "AC DELCO", "MOTORCRAFT", "MOPAR"
      ]
    },
    
    "validation": {
      "min_length": 3,
      "max_length": 10,
      "allow_special_chars": ["-", "_", "."],
      "must_contain": ["number"],
      "normalize_uppercase": true
    },
    
    "delimiters": [",", ";", "\n", " ", "|"],
    "search_order_max": 10,
    
    "search_order": {
      "HD": {
        "description": "Heavy Duty - Buscar DONALDSON primero, luego OEM más comercial",
        "steps": [
          {
            "step": 1,
            "source": "cross_reference",
            "target": "donaldson",
            "pattern": "P\\d{5,6}",
            "priority": 1,
            "description": "Buscar código Donaldson en cross references"
          },
          {
            "step": 2,
            "source": "oem_codes",
            "target": "donaldson",
            "pattern": "P\\d{5,6}",
            "priority": 1,
            "description": "Buscar código Donaldson en OEM codes"
          },
          {
            "step": 3,
            "source": "cross_reference",
            "target": "generic",
            "priority": 2,
            "description": "Si no hay Donaldson, usar primer cross reference (OEM más comercial)"
          },
          {
            "step": 4,
            "source": "oem_codes",
            "target": "generic",
            "priority": 3,
            "description": "Si no hay cross reference, usar primer OEM code"
          }
        ]
      },
      "LD": {
        "description": "Light Duty - Buscar FRAM primero, luego OEM más comercial",
        "steps": [
          {
            "step": 1,
            "source": "cross_reference",
            "target": "fram",
            "pattern": "(PH|CA|CF|CH)\\d{3,6}",
            "priority": 1,
            "description": "Buscar código FRAM en cross references"
          },
          {
            "step": 2,
            "source": "oem_codes",
            "target": "fram",
            "pattern": "(PH|CA|CF|CH)\\d{3,6}",
            "priority": 1,
            "description": "Buscar código FRAM en OEM codes"
          },
          {
            "step": 3,
            "source": "cross_reference",
            "target": "generic",
            "priority": 2,
            "description": "Si no hay FRAM, usar primer cross reference (OEM más comercial)"
          },
          {
            "step": 4,
            "source": "oem_codes",
            "target": "generic",
            "priority": 3,
            "description": "Si no hay cross reference, usar primer OEM code"
          }
        ]
      }
    }
  },

  "prefixes": {
    "description": "Prefijos ELIMFILTERS según TIPO y DUTY - REGLAS ACTUALIZADAS",
    "mapping": {
      "AIRE": {
        "prefix": "EA1",
        "duty": ["HD", "LD"],
        "aliases": ["AIR"]
      },
      "FUEL": {
        "prefix": "EF9",
        "duty": ["HD", "LD"],
        "aliases": ["COMBUSTIBLE"]
      },
      "OIL": {
        "prefix": "EL8",
        "duty": ["HD", "LD"],
        "aliases": ["ACEITE"]
      },
      "CABIN": {
        "prefix": "EC1",
        "duty": ["HD", "LD"],
        "aliases": ["CABIN AIR", "AIRE CABINA"]
      },
      "FUEL SEPARATOR": {
        "prefix": "ES9",
        "duty": ["HD"],
        "aliases": ["SEPARADOR"]
      },
      "AIR DRYER": {
        "prefix": "ED4",
        "duty": ["HD"],
        "aliases": []
      },
      "HIDRAULIC": {
        "prefix": "EH6",
        "duty": ["HD"],
        "aliases": ["HYDRAULIC"]
      },
      "COOLANT": {
        "prefix": "EW7",
        "duty": ["HD"],
        "aliases": ["REFRIGERANTE"]
      },
      "CARCAZA AIR FILTER": {
        "prefix": "EA3",
        "duty": ["HD"],
        "aliases": ["HOUSING"]
      },
      "TURBINE SERIES": {
        "prefix": "ET9",
        "duty": ["HD"],
        "aliases": ["TURBINA"]
      },
      "KITS SERIES HD": {
        "prefix": "EK5",
        "duty": ["HD"],
        "aliases": ["KIT DIESEL"]
      },
      "KITS SERIES LD": {
        "prefix": "EK3",
        "duty": ["LD"],
        "aliases": ["KIT GAS", "KIT PASAJEROS"]
      }
    }
  },

  "rules": {
    "regla_1_determinacion_prefijo": {
      "description": "Determinar prefijo según TIPO y DUTY",
      "priority": 1,
      "steps": [
        "Identificar el TIPO de filtro (Aire, Fuel, Oil, etc.)",
        "Identificar el DUTY level (HD o LD)",
        "Buscar en mapping de prefixes",
        "Si no se encuentra, usar ELM como fallback genérico"
      ],
      "ejemplos": {
        "caso_1": {
          "tipo": "OIL",
          "duty": "HD",
          "resultado": "EL8"
        },
        "caso_2": {
          "tipo": "FUEL",
          "duty": "LD",
          "resultado": "EF9"
        },
        "caso_3": {
          "tipo": "KITS SERIES LD",
          "duty": "LD",
          "resultado": "EK3"
        }
      }
    },
    
    "regla_2_busqueda_base_code_HD": {
      "description": "Obtener base code para Heavy Duty (HD)",
      "priority": 2,
      "duty": "HD",
      "steps": [
        "PASO 1: Buscar código DONALDSON en cross_reference",
        "PASO 2: Si no hay Donaldson en cross_reference, buscar en oem_codes",
        "PASO 3: Si Donaldson encontrado → usar ese código",
        "PASO 4: Si NO hay Donaldson → usar primer código de cross_reference (OEM más comercial)",
        "PASO 5: Si no hay cross_reference → usar primer oem_code",
        "PASO 6: Extraer SOLO números del código seleccionado",
        "PASO 7: Tomar últimos 4 dígitos"
      ],
      "ejemplos": {
        "caso_1_con_donaldson": {
          "cross_reference": ["P552100", "LF3000"],
          "resultado": "P552100 → 552100 → 2100"
        },
        "caso_2_sin_donaldson": {
          "cross_reference": ["1R0739", "LF3000"],
          "oem_codes": ["51515"],
          "resultado": "1R0739 (primer cross_ref) → 10739 → 0739"
        }
      }
    },
    
    "regla_3_busqueda_base_code_LD": {
      "description": "Obtener base code para Light Duty (LD)",
      "priority": 3,
      "duty": "LD",
      "steps": [
        "PASO 1: Buscar código FRAM en cross_reference",
        "PASO 2: Si no hay FRAM en cross_reference, buscar en oem_codes",
        "PASO 3: Si FRAM encontrado → usar ese código",
        "PASO 4: Si NO hay FRAM → usar primer código de cross_reference (OEM más comercial)",
        "PASO 5: Si no hay cross_reference → usar primer oem_code",
        "PASO 6: Extraer SOLO números del código seleccionado",
        "PASO 7: Tomar últimos 4 dígitos"
      ],
      "ejemplos": {
        "caso_1_con_fram": {
          "cross_reference": ["CA10234", "LF3000"],
          "resultado": "CA10234 → 10234 → 0234"
        },
        "caso_2_sin_fram": {
          "cross_reference": ["88922", "LF3000"],
          "oem_codes": ["12345"],
          "resultado": "88922 (primer cross_ref) → 88922 → 8922"
        }
      }
    },
    
    "regla_4_generacion_sku_final": {
      "description": "Combinar PREFIX + BASE CODE para generar SKU",
      "priority": 4,
      "format": "PREFIX-BASECODE",
      "steps": [
        "Obtener PREFIX (de regla_1)",
        "Obtener BASE CODE últimos 4 dígitos (de regla_2 o regla_3)",
        "Combinar: PREFIX + BASE CODE",
        "Formato final: PREFIXBASECODE (sin guiones ni espacios)"
      ],
      "ejemplos": {
        "caso_1": {
          "prefix": "EL8",
          "base_code": "2100",
          "sku": "EL82100"
        },
        "caso_2": {
          "prefix": "EF9",
          "base_code": "5507",
          "sku": "EF95507"
        },
        "caso_3": {
          "prefix": "EA1",
          "base_code": "0234",
          "sku": "EA10234"
        }
      }
    },
    
    "regla_5_validacion_integridad": {
      "description": "Validar que el SKU generado cumple con requisitos",
      "priority": 5,
      "validations": [
        "PREFIX debe estar en lista de prefijos válidos",
        "BASE CODE debe tener exactamente 4 dígitos numéricos",
        "SKU final debe tener formato PREFIXNNNN",
        "Duty level debe ser HD o LD",
        "Tipo debe estar en lista de tipos válidos"
      ]
    }
  },

  "metadata": {
    "author": "ELIMFILTERS Team",
    "last_updated": "2025-10-17",
    "version_history": [
      {
        "version": "2.2.0",
        "date": "2025-10-17",
        "changes": "Actualización completa con reglas correctas de SKU según tabla oficial"
      },
      {
        "version": "2.1.0",
        "date": "2025-10-23",
        "changes": "Reglas anteriores (OBSOLETAS)"
      }
    ]
  }
}
